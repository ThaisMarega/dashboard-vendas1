<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <title>Dashboard de Vendas - Imagem Modas</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      :root {
        --green: #585f3b;
        --green-soft: #f0f2eb;
        --gold: #c89a3b;
        --gold-soft: #f7efe0;
        --text-main: #333333;
        --text-soft: #777777;
        --card-bg: #ffffff;
        --card-shadow: 0 14px 45px rgba(0, 0, 0, 0.08);
        --radius-card: 18px;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        padding: 24px 16px 40px;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        background: radial-gradient(circle at top, #f9f5ec 0, #f3f3f3 40%, #efefef 100%);
        color: var(--text-main);
      }

      .page {
        max-width: 1040px;
        margin: 0 auto;
      }

      /* TOPO COM LOGO */

      .topbar {
        display: flex;
        align-items: center;
        gap: 14px;
        margin-bottom: 32px;
      }

      .logo-circle-img {
        width: 64px;
        height: 64px;
        border-radius: 50%;
        display: block;
        object-fit: cover;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.18);
      }

      .logo-text {
        letter-spacing: 0.25em;
        text-transform: uppercase;
        font-size: 14px;
        color: var(--text-main);
      }

      /* CART√ÉO CENTRAL (LOGIN / DASHBOARD WRAPPER) */

      .card-shell {
        background: #ffffffd9;
        border-radius: 32px;
        box-shadow: var(--card-shadow);
        padding: 32px 26px 28px;
      }

      @media (min-width: 768px) {
        .card-shell {
          padding: 40px 40px 32px;
        }
      }

      .card-header-line {
        font-size: 13px;
        text-transform: uppercase;
        letter-spacing: 0.22em;
        color: var(--text-soft);
        margin-bottom: 8px;
      }

      .card-title {
        font-size: 22px;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        margin: 0 0 6px;
      }

      .card-subtitle {
        margin: 0 0 22px;
        font-size: 14px;
        color: var(--text-soft);
      }

      /* LOGIN */

      #login-card label {
        display: block;
        font-size: 13px;
        font-weight: 600;
        margin-bottom: 4px;
      }

      #login-card input {
        width: 100%;
        padding: 10px 12px;
        border-radius: 999px;
        border: 1px solid #d3d3d3;
        font-size: 14px;
        margin-bottom: 12px;
      }

      .actions-row {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 8px;
      }

      button {
        cursor: pointer;
        border-radius: 999px;
        border: none;
        padding: 9px 18px;
        font-size: 14px;
        font-weight: 600;
        letter-spacing: 0.06em;
        text-transform: uppercase;
      }

      .btn-primary {
        background: var(--green);
        color: #fff;
      }

      .btn-secondary {
        background: transparent;
        color: var(--green);
        border: 1px solid var(--green);
      }

      .status {
        font-size: 13px;
        color: #c0392b;
        margin-bottom: 14px;
      }

      /* DASHBOARD */

      #dashboard {
        display: none; /* √© mostrado via JS ap√≥s login */
      }

      .dash-header {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        align-items: center;
        gap: 10px;
        margin-bottom: 24px;
      }

      .dash-hello {
        font-size: 18px;
        font-weight: 600;
      }

      .dash-hello span {
        color: var(--green);
      }

      .dash-date {
        font-size: 13px;
        color: var(--text-soft);
      }

      .dash-meta-pill {
        background: var(--gold-soft);
        border-radius: 999px;
        padding: 6px 14px;
        font-size: 12px;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        color: #7a5a20;
      }

      .dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: var(--gold);
      }

      /* GRID DE CARDS RESUMO */

      .summary-grid {
        display: grid;
        grid-template-columns: minmax(0, 1.3fr) minmax(0, 1fr) minmax(0, 1fr);
        gap: 18px;
        margin-bottom: 26px;
      }

      @media (max-width: 880px) {
        .summary-grid {
          grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
        }
        .summary-grid .card-summary-main {
          grid-column: 1 / -1;
        }
      }

      @media (max-width: 600px) {
        .summary-grid {
          grid-template-columns: minmax(0, 1fr);
        }
      }

      .card-summary {
        background: var(--card-bg);
        border-radius: var(--radius-card);
        padding: 16px 18px 14px;
        box-shadow: 0 8px 26px rgba(0, 0, 0, 0.05);
      }

      .card-summary-main {
        background: linear-gradient(135deg, #fdf8ed, #f5efe3);
        border-radius: 22px;
      }

      .card-summary-title {
        font-size: 13px;
        text-transform: uppercase;
        letter-spacing: 0.16em;
        color: var(--text-soft);
        margin-bottom: 6px;
      }

      .card-summary-value-big {
        font-size: 24px;
        font-weight: 700;
        margin-bottom: 4px;
      }

      .card-summary-meta-row {
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        gap: 8px;
        font-size: 13px;
        color: var(--text-soft);
      }

      .chip-positive {
        font-size: 11px;
        padding: 3px 8px;
        border-radius: 999px;
        background: rgba(88, 95, 59, 0.08);
        color: var(--green);
      }

      .card-summary-number {
        font-size: 22px;
        font-weight: 600;
      }

      .card-summary-caption {
        font-size: 12px;
        color: var(--text-soft);
      }

      /* VENDAS RECENTES */

      .section-block {
        background: var(--card-bg);
        border-radius: var(--radius-card);
        box-shadow: 0 8px 26px rgba(0, 0, 0, 0.05);
        padding: 16px 18px 18px;
      }

      .section-title-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }

      .section-title {
        font-size: 14px;
        text-transform: uppercase;
        letter-spacing: 0.14em;
        color: var(--text-soft);
      }

      .section-sub {
        font-size: 12px;
        color: var(--text-soft);
      }

      table {
        width: 100%;
        border-collapse: collapse;
        font-size: 13px;
      }

      th,
      td {
        padding: 6px 4px;
        text-align: left;
      }

      th {
        font-weight: 600;
        color: var(--text-soft);
        border-bottom: 1px solid #ececec;
      }

      tr + tr td {
        border-top: 1px solid #f2f2f2;
      }

      .text-right {
        text-align: right;
      }

      .badge-pill {
        font-size: 11px;
        padding: 2px 7px;
        border-radius: 999px;
        border: 1px solid #e0e0e0;
        background: #fafafa;
      }

      .muted {
        color: var(--text-soft);
      }

      .hidden {
        display: none !important;
      }
/* ===== Bot√£o flutuante (+) ===== */
.fab-main {
  position: fixed;
  right: 24px;
  bottom: 24px;
  width: 56px;
  height: 56px;
  border-radius: 50%;
  border: none;
  cursor: pointer;
  font-size: 32px;
  line-height: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #525739; /* verde Imagem */
  color: #f5e5c7;      /* dourado claro */
  box-shadow: 0 8px 18px rgba(0,0,0,0.25);
  z-index: 40;
}

.fab-main:hover {
  transform: translateY(-1px);
  box-shadow: 0 10px 22px rgba(0,0,0,0.3);
}

/* Menu do bot√£o flutuante */
.fab-menu {
  position: fixed;
  right: 24px;
  bottom: 90px;
  display: flex;
  flex-direction: column;
  gap: 8px;
  z-index: 35;
}

.fab-menu button {
  border: none;
  border-radius: 999px;
  padding: 8px 14px;
  background: #ffffff;
  color: #333;
  font-size: 13px;
  font-weight: 500;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(0,0,0,0.12);
  text-align: left;
}

.fab-menu button span {
  font-size: 11px;
  font-weight: 400;
  color: #777;
  display: block;
}

/* Overlay escuro atr√°s do modal */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.28);
  backdrop-filter: blur(2px);
  z-index: 45;
}

/* Janela modal */
.modal {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 50;
}

.modal-card {
  width: 100%;
  max-width: 420px;
  background: #fdfbf6;
  border-radius: 18px;
  padding: 20px 22px;
  box-shadow: 0 16px 40px rgba(0,0,0,0.22);
  border: 1px solid rgba(82,87,57,0.15);
}

.modal-title {
  font-size: 18px;
  font-weight: 600;
  margin-bottom: 4px;
  color: #3e4328;
}

.modal-subtitle {
  font-size: 12px;
  color: #777;
  margin-bottom: 16px;
}

.modal-row {
  display: flex;
  gap: 10px;
}

.modal-row > div {
  flex: 1;
}

.modal-label {
  font-size: 12px;
  font-weight: 600;
  color: #555;
  margin-bottom: 4px;
  display: block;
}

.modal-input,
.modal-select,
.modal-textarea {
  width: 100%;
  border-radius: 10px;
  border: 1px solid #ddd;
  padding: 8px 10px;
  font-size: 14px;
  font-family: inherit;
  box-sizing: border-box;
}

.modal-textarea {
  resize: vertical;
  min-height: 60px;
}

.modal-actions {
  display: flex;
  justify-content: flex-end;
  gap: 8px;
  margin-top: 16px;
}

.btn-secondary {
  border-radius: 999px;
  border: 1px solid #ccc;
  background: #fff;
  padding: 7px 14px;
  font-size: 13px;
  cursor: pointer;
}

.btn-primary {
  border-radius: 999px;
  border: none;
  background: #525739;
  color: #f5e5c7;
  padding: 7px 16px;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
}

/* util */
.hidden {
  display: none !important;
}
    </style>
  </head>

  <body>
    <div class="page">
      <!-- TOPO COM LOGO -->
      <header class="topbar">
        <img
          src="001 LOGO_Prancheta 1 c√≥pia 27.png"
          alt="Imagem Modas - monograma IMG"
          class="logo-circle-img"
        />
        <div class="logo-text">IMAGEM&nbsp;&nbsp;MODAS</div>
      </header>

      <!-- CARTAÃÉO PRINCIPAL (LOGIN + DASHBOARD) -->
      <main class="card-shell">
        <!-- CABECALHO COM TITULO -->
        <div id="login-header">
          <div class="card-header-line">Dashboard de vendas</div>
          <h1 class="card-title">Acesso exclusivo para vendedoras</h1>
          <p class="card-subtitle">
            Fa√ßa login para acompanhar sua meta di√°ria, vendas e condicionais em tempo real.
          </p>
        </div>

        <!-- LOGIN -->
        <section id="login-card">
          <p id="status" class="status"></p>

          <label for="nome">Nome da vendedora</label>
          <input id="nome" placeholder="Ex: Allane" />

          <label for="senha">Senha</label>
          <input id="senha" type="password" placeholder="Digite sua senha" />

          <div class="actions-row">
            <button class="btn-primary" onclick="login()">Entrar</button>
            <button class="btn-secondary" onclick="buscarMetaSemLogin()">
              Buscar meta de hoje
            </button>
          </div>
        </section>

        <!-- DASHBOARD (AP√ìS LOGIN) -->
        <section id="dashboard">
          <div class="dash-header">
            <div>
              <div class="dash-hello">
                Bom dia, <span id="nomeVendedoraSpan">Vendedora</span>
              </div>
              <div class="dash-date" id="dash-date"></div>
            </div>
            <div>
              <span class="dash-meta-pill">
                <span class="dot"></span>
                Meta do dia: <strong id="meta-dia-pill">‚Äì</strong>
              </span>
            </div>
          </div>

          <!-- RESUMO EM CARDS -->
          <div class="summary-grid">
            <!-- META / REALIZADO -->
            <div class="card-summary card-summary-main">
              <div class="card-summary-title">Meta di√°ria</div>
              <div class="card-summary-value-big" id="valor-realizado-hoje">
                R$ 0,00
              </div>
              <div class="card-summary-meta-row">
                <div>
                  Meta: <strong id="meta-dia">R$ 0,00</strong><br />
                  <span class="muted">
                    Falta: <span id="falta-meta">R$ 0,00</span>
                  </span>
                </div>
                <div class="chip-positive" id="meta-percent">
                  0% da meta
                </div>
              </div>
            </div>

            <!-- VENDAS E TICKET -->
            <div class="card-summary">
              <div class="card-summary-title">Vendas de hoje</div>
              <div class="card-summary-number" id="qtd-vendas">0</div>
              <div class="card-summary-caption">
                Ticket m√©dio: <span id="ticket-medio">R$ 0,00</span>
              </div>
            </div>

            <!-- ATENDIMENTOS / CONVERS√ÉO -->
            <div class="card-summary">
              <div class="card-summary-title">Atendimentos</div>
              <div class="card-summary-number" id="qtd-atendimentos">0</div>
              <div class="card-summary-caption">
                Taxa de convers√£o:
                <span id="taxa-conversao">0%</span>
              </div>
            </div>
          </div>

          <!-- CONDICIONAIS & LISTA DE VENDAS -->
          <div class="summary-grid" style="margin-bottom: 0;">
            <!-- CARD CONDICIONAIS -->
            <div class="card-summary">
              <div class="card-summary-title">Condicionais em aberto</div>
              <div class="card-summary-number" id="qtd-condicionais">0</div>
              <div class="card-summary-caption">
                Valor total aproximado:
                <span id="valor-condicionais">R$ 0,00</span>
              </div>
            </div>

            <!-- TABELA DE VENDAS (OCUPA 2 COLUNAS EM TELAS GRANDES) -->
            <div class="summary-grid" style="grid-template-columns: 1fr; gap:0;">
              <div class="section-block">
                <div class="section-title-row">
                  <div>
                    <div class="section-title">Vendas recentes</div>
                    <div class="section-sub">
                      √öltimas vendas lan√ßadas hoje
                    </div>
                  </div>
                  <button class="btn-secondary" onclick="logout()">
                    Sair
                  </button>
                </div>

                <div id="sem-vendas" class="section-sub">
                  Nenhuma venda lan√ßada ainda hoje.
                </div>

                <table id="tabela-vendas" class="hidden">
                  <thead>
                    <tr>
                      <th>Hor√°rio</th>
                      <th>Cliente</th>
                      <th class="text-right">Valor</th>
                      <th>Forma</th>
                    </tr>
                  </thead>
                  <tbody id="tbody-vendas"></tbody>
                </table>
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>
<!-- Bot√£o flutuante + menu -->
  <button id="fab-main" class="fab-main">+</button>

  <div id="fab-menu" class="fab-menu hidden">
    <button data-action="venda">
      Lan√ßar venda
      <span>Registrar uma venda com valor e forma de pagamento</span>
    </button>
    <button data-action="atendimento">
      Registrar atendimentos
      <span>Quantidade de atendimentos do dia</span>
    </button>
    <button data-action="condicional">
      Lan√ßar condicional
      <span>Controle dos consignados em aberto</span>
    </button>
  </div>

  <!-- Overlay e modais -->
  <div id="modal-overlay" class="modal-overlay hidden"></div>

  <!-- Modal Lan√ßar venda -->
  <div id="modal-venda" class="modal hidden">
    <div class="modal-card">
      <div class="modal-title">Lan√ßar venda</div>
      <div class="modal-subtitle">Registre uma venda realizada hoje.</div>

      <div class="modal-row">
        <div>
          <label class="modal-label">Valor (R$)</label>
          <input id="venda-valor" type="number" step="0.01" class="modal-input" />
        </div>
        <div>
          <label class="modal-label">Forma de pagamento</label>
          <select id="venda-forma" class="modal-select">
            <option value="">Selecione</option>
            <option value="avista">√Ä vista</option>
            <option value="debito">D√©bito</option>
            <option value="credito">Cr√©dito</option>
            <option value="pix">Pix</option>
            <option value="prazo">Prazo</option>
          </select>
        </div>
      </div>

      <label class="modal-label">Nome da cliente (opcional)</label>
      <input id="venda-cliente" type="text" class="modal-input" />

      <label class="modal-label">Observa√ß√£o</label>
      <textarea id="venda-observacao" class="modal-textarea"></textarea>

      <div class="modal-actions">
        <button type="button" class="btn-secondary" data-close-modal>Cancelar</button>
        <button type="button" class="btn-primary" id="btn-salvar-venda">Salvar venda</button>
      </div>
    </div>
  </div>

  <!-- Modal Atendimentos -->
  <div id="modal-atendimento" class="modal hidden">
    <div class="modal-card">
      <div class="modal-title">Registrar atendimentos</div>
      <div class="modal-subtitle">Informe quantos atendimentos voc√™ teve hoje.</div>

      <label class="modal-label">Quantidade de atendimentos de hoje</label>
      <input id="atend-qtd" type="number" class="modal-input" min="0" />

      <div class="modal-actions">
        <button type="button" class="btn-secondary" data-close-modal>Cancelar</button>
        <button type="button" class="btn-primary" id="btn-salvar-atendimento">Salvar</button>
      </div>
    </div>
  </div>

  <!-- Modal Condicional -->
  <div id="modal-condicional" class="modal hidden">
    <div class="modal-card">
      <div class="modal-title">Lan√ßar condicional</div>
      <div class="modal-subtitle">Registre um novo condicional em aberto.</div>

      <div class="modal-row">
        <div>
          <label class="modal-label">Qtd. de pe√ßas</label>
          <input id="cond-qtd" type="number" class="modal-input" min="1" />
        </div>
        <div>
          <label class="modal-label">Valor total (R$)</label>
          <input id="cond-valor" type="number" step="0.01" class="modal-input" />
        </div>
      </div>

      <label class="modal-label">Nome da cliente</label>
      <input id="cond-cliente" type="text" class="modal-input" />

      <label class="modal-label">Observa√ß√£o</label>
      <textarea id="cond-observacao" class="modal-textarea"></textarea>

      <div class="modal-actions">
        <button type="button" class="btn-secondary" data-close-modal>Cancelar</button>
        <button type="button" class="btn-primary" id="btn-salvar-condicional">Salvar condicional</button>
      </div>
    </div>
  </div>
    <script>
      const API = "https://dashboard-vendas1.onrender.com/api";

      function formatMoney(v) {
        const num = Number(v || 0);
        return num.toLocaleString("pt-BR", {
          style: "currency",
          currency: "BRL",
          minimumFractionDigits: 2,
        });
      }

      function formatPercent(v) {
        const num = Number(v || 0);
        return num.toLocaleString("pt-BR", {
          minimumFractionDigits: 0,
          maximumFractionDigits: 1,
        }) + "%";
      }

      function hojeISO() {
        return new Date().toISOString().slice(0, 10);
      }

      function setStatus(msg, isError = true) {
        const el = document.getElementById("status");
        el.textContent = msg || "";
        el.style.color = isError ? "#c0392b" : "#2e7d32";
      }

      function mostrarLogin() {
        document.getElementById("login-card").style.display = "block";
        document.getElementById("login-header").style.display = "block";
        document.getElementById("dashboard").style.display = "none";
      }

      function mostrarDashboard() {
        document.getElementById("login-card").style.display = "none";
        document.getElementById("login-header").style.display = "none";
        document.getElementById("dashboard").style.display = "block";
      }

      async function login() {
        const nome = document.getElementById("nome").value.trim();
        const senha = document.getElementById("senha").value.trim();

        if (!nome || !senha) {
          setStatus("Preencha nome e senha.");
          return;
        }

        setStatus("Conectando...", false);

        try {
          const resp = await fetch(API + "/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ nome, senha }),
          });

          if (!resp.ok) {
            setStatus("Falha no login. Confira o nome e a senha.");
            return;
          }

          const data = await resp.json();
          localStorage.setItem("token", data.token);
          localStorage.setItem("vendedoraNome", data.vendedora.nome);

          setStatus("");
          iniciarDashboard();
        } catch (e) {
          console.error(e);
          setStatus("Erro ao conectar com o servidor.");
        }
      }

      function logout() {
        localStorage.removeItem("token");
        localStorage.removeItem("vendedoraNome");
        location.reload();
      }

      async function buscarMetaSemLogin() {
        setStatus(
          "Para usar o sistema completo √© necess√°rio login, mas a meta ser√° buscada pelo sistema em breve.",
          false
        );
      }

      function preencherCabecalhoDashboard() {
        const nome = localStorage.getItem("vendedoraNome") || "Vendedora";
        document.getElementById("nomeVendedoraSpan").textContent = nome;

        const hoje = new Date();
        const formatado = hoje.toLocaleDateString("pt-BR", {
          weekday: "long",
          day: "2-digit",
          month: "long",
        });
        document.getElementById("dash-date").textContent =
          formatado.charAt(0).toUpperCase() + formatado.slice(1);
      }

      async function carregarResumo() {
        const token = localStorage.getItem("token");
        if (!token) return;

        const headers = { Authorization: "Bearer " + token };
        const hoje = hojeISO();

        try {
          const [metaResp, vendasResp, atendResp, condResp] = await Promise.all([
            fetch(API + "/metas/" + hoje, { headers }),
            fetch(API + "/vendas?dataInicio=" + hoje + "&dataFim=" + hoje, {
              headers,
            }),
            fetch(API + "/atendimentos/" + hoje, { headers }),
            fetch(API + "/condicionais", { headers }),
          ]);

          const meta = await metaResp.json();
          const vendas = await vendasResp.json();
          const atendimentos = await atendResp.json();
          const condicionais = await condResp.json();

          const valorMeta = Number(meta.valor_meta || meta.valorMeta || 0);
          const totalVendas = (vendas || []).reduce(
            (acc, v) => acc + Number(v.valor || 0),
            0
          );
          const qtdVendas = (vendas || []).length;
          const qtdAtend = Number(atendimentos.quantidade || 0);
          const ticketMedio = qtdVendas ? totalVendas / qtdVendas : 0;
          const conversao =
            qtdAtend > 0 ? (qtdVendas / qtdAtend) * 100 : 0;
          const qtdCond = (condicionais || []).length;
          const valorCond = (condicionais || []).reduce(
            (acc, c) => acc + Number(c.valor_total || 0),
            0
          );
          const faltaMeta = valorMeta - totalVendas;
          const percMeta = valorMeta > 0 ? (totalVendas / valorMeta) * 100 : 0;

          // Atualiza cards
          document.getElementById("meta-dia").textContent =
            formatMoney(valorMeta);
          document.getElementById("meta-dia-pill").textContent =
            formatMoney(valorMeta);
          document.getElementById("valor-realizado-hoje").textContent =
            formatMoney(totalVendas);
          document.getElementById("falta-meta").textContent =
            formatMoney(Math.max(faltaMeta, 0));
          document.getElementById("meta-percent").textContent =
            formatPercent(percMeta) + " da meta";

          document.getElementById("qtd-vendas").textContent = qtdVendas;
          document.getElementById("ticket-medio").textContent =
            formatMoney(ticketMedio);

          document.getElementById("qtd-atendimentos").textContent = qtdAtend;
          document.getElementById("taxa-conversao").textContent =
            formatPercent(conversao);

          document.getElementById("qtd-condicionais").textContent = qtdCond;
          document.getElementById("valor-condicionais").textContent =
            formatMoney(valorCond);

          // Tabela de vendas
          const semVendasEl = document.getElementById("sem-vendas");
          const tabelaVendas = document.getElementById("tabela-vendas");
          const tbody = document.getElementById("tbody-vendas");

          if (!vendas || vendas.length === 0) {
            semVendasEl.classList.remove("hidden");
            tabelaVendas.classList.add("hidden");
          } else {
            semVendasEl.classList.add("hidden");
            tabelaVendas.classList.remove("hidden");
            tbody.innerHTML = "";

            vendas
              .slice(0, 8)
              .forEach((v) => {
                const tr = document.createElement("tr");

                const dataVenda = v.data_venda
                  ? new Date(v.data_venda)
                  : null;
                const hora =
                  dataVenda != null
                    ? dataVenda.toLocaleTimeString("pt-BR", {
                        hour: "2-digit",
                        minute: "2-digit",
                      })
                    : "-";

                const tdHora = document.createElement("td");
                tdHora.textContent = hora;

                const tdCliente = document.createElement("td");
                tdCliente.textContent = v.cliente_nome || "Cliente";

                const tdValor = document.createElement("td");
                tdValor.textContent = formatMoney(v.valor);
                tdValor.className = "text-right";

                const tdForma = document.createElement("td");
                tdForma.innerHTML =
                  '<span class="badge-pill">' +
                  (v.forma_pagamento || "").toUpperCase() +
                  "</span>";

                tr.appendChild(tdHora);
                tr.appendChild(tdCliente);
                tr.appendChild(tdValor);
                tr.appendChild(tdForma);

                tbody.appendChild(tr);
              });
          }
        } catch (e) {
          console.error(e);
          setStatus("N√£o foi poss√≠vel carregar o resumo agora.", true);
        }
      }

      function iniciarDashboard() {
        mostrarDashboard();
        preencherCabecalhoDashboard();
        carregarResumo();
      }

      // Ao carregar a p√°gina, se j√° tiver token, pula direto pro dashboard
      window.addEventListener("DOMContentLoaded", () => {
        const token = localStorage.getItem("token");
        if (token) {
          setStatus("");
          iniciarDashboard();
        } else {
          mostrarLogin();
        }
      });
      // =============== FUN√á√ïES AUXILIARES ===============
function getToken() {
  return localStorage.getItem('token');
}

function hojeISO() {
  return new Date().toISOString().slice(0, 10);
}

// Mostra / esconde overlay e modais
function abrirModal(id) {
  const overlay = document.getElementById('modal-overlay');
  const modal = document.getElementById(id);
  if (!overlay || !modal) return;
  overlay.classList.remove('hidden');
  modal.classList.remove('hidden');
}

function fecharTodosModais() {
  const overlay = document.getElementById('modal-overlay');
  const modais = document.querySelectorAll('.modal');
  overlay && overlay.classList.add('hidden');
  modais.forEach(m => m.classList.add('hidden'));
}

// =============== INICIALIZA√á√ÉO DOS BOT√ïES ===============
document.addEventListener('DOMContentLoaded', () => {
  const fabMain = document.getElementById('fab-main');
  const fabMenu = document.getElementById('fab-menu');
  const overlay = document.getElementById('modal-overlay');

  if (!fabMain || !fabMenu) return;

  // abre/fecha menu do bot√£o +
  fabMain.addEventListener('click', () => {
    fabMenu.classList.toggle('hidden');
  });

  // clique nas op√ß√µes do menu
  fabMenu.addEventListener('click', (e) => {
    const btn = e.target.closest('button');
    if (!btn) return;

    const action = btn.getAttribute('data-action');
    fabMenu.classList.add('hidden');

    if (action === 'venda') abrirModal('modal-venda');
    if (action === 'atendimento') abrirModal('modal-atendimento');
    if (action === 'condicional') abrirModal('modal-condicional');
  });

  // fechar modais ao clicar no overlay
  if (overlay) {
    overlay.addEventListener('click', fecharTodosModais);
  }

  // fechar modais nos bot√µes "Cancelar"
  document.querySelectorAll('[data-close-modal]').forEach(btn => {
    btn.addEventListener('click', fecharTodosModais);
  });

  // ========== SALVAR VENDA ==========
  const btnVenda = document.getElementById('btn-salvar-venda');
  if (btnVenda) {
    btnVenda.addEventListener('click', async () => {
      const token = getToken();
      if (!token) {
        alert('Fa√ßa login novamente.');
        return;
      }

      const valor = parseFloat(document.getElementById('venda-valor').value || '0');
      const formaPagamento = document.getElementById('venda-forma').value;
      const clienteNome = document.getElementById('venda-cliente').value || '';
      const observacao = document.getElementById('venda-observacao').value || '';

      if (!valor || !formaPagamento) {
        alert('Informe o valor e a forma de pagamento.');
        return;
      }

      try {
        const resp = await fetch(API + '/vendas', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + token
          },
          body: JSON.stringify({ valor, formaPagamento, clienteNome, observacao })
        });

        if (!resp.ok) throw new Error('Erro ao salvar venda');

        alert('Venda lan√ßada com sucesso! üéâ');
        fecharTodosModais();
        location.reload();
      } catch (e) {
        console.error(e);
        alert('N√£o foi poss√≠vel salvar a venda.');
      }
    });
  }

  // ========== SALVAR ATENDIMENTO ==========
  const btnAtend = document.getElementById('btn-salvar-atendimento');
  if (btnAtend) {
    btnAtend.addEventListener('click', async () => {
      const token = getToken();
      if (!token) {
        alert('Fa√ßa login novamente.');
        return;
      }

      const quantidade = parseInt(document.getElementById('atend-qtd').value || '0', 10);
      if (!quantidade && quantidade !== 0) {
        alert('Informe a quantidade de atendimentos.');
        return;
      }

      try {
        const resp = await fetch(API + '/atendimentos', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + token
          },
          body: JSON.stringify({ quantidade, data: hojeISO() })
        });

        if (!resp.ok) throw new Error('Erro ao salvar atendimentos');

        alert('Atendimentos salvos! ‚úÖ');
        fecharTodosModais();
        location.reload();
      } catch (e) {
        console.error(e);
        alert('N√£o foi poss√≠vel salvar os atendimentos.');
      }
    });
  }

  // ========== SALVAR CONDICIONAL ==========
  const btnCond = document.getElementById('btn-salvar-condicional');
  if (btnCond) {
    btnCond.addEventListener('click', async () => {
      const token = getToken();
      if (!token) {
        alert('Fa√ßa login novamente.');
        return;
      }

      const quantidadePecas = parseInt(document.getElementById('cond-qtd').value || '0', 10);
      const valorTotal = parseFloat(document.getElementById('cond-valor').value || '0');
      const clienteNome = document.getElementById('cond-cliente').value || '';
      const observacao = document.getElementById('cond-observacao').value || '';

      if (!quantidadePecas || !valorTotal || !clienteNome) {
        alert('Preencha quantidade, valor e nome da cliente.');
        return;
      }

      try {
        const resp = await fetch(API + '/condicionais', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + token
          },
          body: JSON.stringify({ quantidadePecas, valorTotal, clienteNome, observacao })
        });

        if (!resp.ok) throw new Error('Erro ao salvar condicional');

        alert('Condicional lan√ßado com sucesso! üì¶');
        fecharTodosModais();
        location.reload();
      } catch (e) {
        console.error(e);
        alert('N√£o foi poss√≠vel salvar o condicional.');
      }
    });
  }
});
    </script>
  </body>
</html>
