<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <title>Painel da Gerente - Imagem Modas</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
      :root {
        --verde: #5b6240;
        --bege: #f4f1ea;
        --dourado: #c7a15a;
        --texto: #333;
        --erro: #b3261e;
        --sucesso: #1b873f;
      }

      body {
        margin: 0;
        padding: 0;
        background: var(--bege);
        font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
        color: var(--texto);
        padding: 20px;
      }

      header {
        display: flex;
        align-items: center;
        gap: 16px;
        margin-bottom: 20px;
      }

      header img {
        width: 60px;
        height: 60px;
        border-radius: 50%;
      }

      h1 {
        font-size: 20px;
        margin: 0;
        text-transform: uppercase;
        letter-spacing: 0.1em;
      }

      .status {
        padding: 10px;
        border-radius: 8px;
        margin-bottom: 20px;
        font-size: 14px;
      }

      .erro {
        background: #ffe5e5;
        color: var(--erro);
      }

      .sucesso {
        background: #e6f4ea;
        color: var(--sucesso);
      }

      .card {
        background: white;
        border-radius: 14px;
        padding: 18px;
        margin-bottom: 20px;
        box-shadow: 0 4px 14px rgba(0,0,0,0.06);
      }

      table {
        width: 100%;
        font-size: 13px;
        border-collapse: collapse;
        margin-top: 10px;
      }

      th, td {
        padding: 8px 6px;
        border-bottom: 1px solid #eee;
        text-align: left;
      }

      th {
        text-transform: uppercase;
        font-size: 11px;
        letter-spacing: 0.07em;
        color: #555;
      }

      input, button {
        padding: 8px 12px;
        border-radius: 8px;
        border: 1px solid #ccc;
        font-size: 14px;
      }

      button {
        cursor: pointer;
        background: var(--verde);
        color: white;
        border: none;
        font-weight: 600;
      }

      .row {
        display: flex;
        gap: 10px;
        margin-bottom: 10px;
      }

      .row > div {
        flex: 1;
      }
    </style>
  </head>

  <body>
    <header>
      <img src="001 LOGO_Prancheta 1 cópia 27.png" />
      <div>
        <h1>Painel da Gerente</h1>
        <div style="font-size: 12px; color: #666; letter-spacing: 0.1em;">
          Imagem Modas
        </div>
      </div>
    </header>

    <div id="status" class="status">Faça login para acessar o painel.</div>

    <!-- LOGIN GERENTE -->
    <div id="loginCard" class="card">
      <h3>Login da gerente</h3>

      <div class="row">
        <div>
          <label>Usuário</label>
          <input id="gerenteUser" value="gerente" />
        </div>
        <div>
          <label>Senha</label>
          <input id="gerenteSenha" type="password" value="gerente2025" />
        </div>
      </div>

      <button onclick="loginGerente()">Entrar</button>
    </div>

    <!-- PAINEL -->
    <div id="painel" style="display: none">
      <!-- CADASTRAR NOVA VENDEDORA -->
      <div class="card">
        <h3>Cadastrar nova vendedora</h3>

        <div class="row">
          <div><label>Nome</label><input id="novaNome" /></div>
          <div><label>Email</label><input id="novaEmail" /></div>
        </div>

        <div class="row">
          <div><label>Senha</label><input id="novaSenha" /></div>
          <div><label>Meta padrão</label><input id="novaMeta" value="15000" /></div>
        </div>

        <button onclick="cadastrarVendedora()">Cadastrar</button>
      </div>

      <!-- RESUMO -->
      <div class="card">
        <h3>Resumo geral</h3>
        <div id="resumoGeral">Carregando…</div>
      </div>

      <!-- TODAS AS VENDAS -->
      <div class="card">
        <h3>Todas as vendas</h3>
        <table id="tabelaVendas">
          <thead>
            <tr>
              <th>Data</th>
              <th>Hora</th>
              <th>Vendedora</th>
              <th>Cliente</th>
              <th>Forma</th>
              <th>Valor</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <!-- ATENDIMENTOS -->
      <div class="card">
        <h3>Atendimentos</h3>
        <table id="tabelaAtend">
          <thead>
            <tr>
              <th>Data</th>
              <th>Vendedora</th>
              <th>Qtd</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <!-- METAS -->
      <div class="card">
        <h3>Metas diárias</h3>
        <table id="tabelaMetas">
          <thead>
            <tr>
              <th>Data</th>
              <th>Vendedora</th>
              <th>Meta</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

    </div>

    <script>
      const API = "https://dashboard-vendas1.onrender.com/api";
      let token = null;

      function setStatus(msg, tipo = "") {
        const el = document.getElementById("status");
        el.textContent = msg;
        el.className = "status " + tipo;
      }

      async function loginGerente() {
        const user = gerenteUser.value.trim();
        const senha = gerenteSenha.value.trim();

        setStatus("Conectando…");

        const resp = await fetch(API + "/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ nome: user, senha }),
        });

        if (!resp.ok) {
          setStatus("Falha no login.", "erro");
          return;
        }

        const data = await resp.json();

        if (!data.vendedora.isGerente) {
          setStatus("Acesso negado. Este usuário não é gerente.", "erro");
          return;
        }

        token = data.token;

        loginCard.style.display = "none";
        painel.style.display = "block";

        setStatus("Gerente logada.", "sucesso");

        carregarTudo();
      }

      function auth() {
        return { Authorization: "Bearer " + token };
      }

      async function cadastrarVendedora() {
        const nome = novaNome.value.trim();
        const email = novaEmail.value.trim();
        const senha = novaSenha.value.trim();
        const metaPadrao = Number(novaMeta.value);

        if (!nome || !senha) {
          setStatus("Preencha nome e senha.", "erro");
          return;
        }

        const resp = await fetch(API + "/admin/vendedoras", {
          method: "POST",
          headers: {
            ...auth(),
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ nome, email, senha, metaPadrao }),
        });

        if (!resp.ok) {
          setStatus("Erro ao cadastrar.", "erro");
          return;
        }

        novaNome.value = "";
        novaEmail.value = "";
        novaSenha.value = "";

        setStatus("Vendedora cadastrada.", "sucesso");

        carregarTudo();
      }

      async function carregarTudo() {
        carregarResumo();
        carregarVendas();
        carregarAtendimentos();
        carregarMetas();
      }

      async function carregarResumo() {
        const resp = await fetch(API + "/admin/resumo", { headers: auth() });
        const data = await resp.json();
        resumoGeral.textContent =
          `Vendas hoje: ${data.vendasHoje} | ` +
          `Total R$: ${data.totalHoje.toFixed(2)} | ` +
          `Atendimentos: ${data.atendimentosHoje}`;
      }

      async function carregarVendas() {
        const resp = await fetch(API + "/admin/vendas", { headers: auth() });
        const dados = await resp.json();

        const tbody = document.querySelector("#tabelaVendas tbody");
        tbody.innerHTML = "";

        dados.forEach((v) => {
          const d = new Date(v.data_venda);
          const tr = document.createElement("tr");

          tr.innerHTML = `
            <td>${d.toLocaleDateString("pt-BR")}</td>
            <td>${d.toLocaleTimeString("pt-BR",{hour:'2-digit',minute:'2-digit'})}</td>
            <td>${v.vendedora}</td>
            <td>${v.cliente_nome || "-"}</td>
            <td>${v.forma_pagamento}</td>
            <td>R$ ${Number(v.valor).toFixed(2)}</td>
          `;
          tbody.appendChild(tr);
        });
      }

      async function carregarAtendimentos() {
        const resp = await fetch(API + "/admin/atendimentos", {
          headers: auth(),
        });
        const dados = await resp.json();

        const tbody = document.querySelector("#tabelaAtend tbody");
        tbody.innerHTML = "";

        dados.forEach((a) => {
          const d = new Date(a.data_registro);
          const tr = document.createElement("tr");

          tr.innerHTML = `
            <td>${d.toLocaleDateString("pt-BR")}</td>
            <td>${a.vendedora}</td>
            <td>${a.quantidade}</td>
          `;
          tbody.appendChild(tr);
        });
      }

      async function carregarMetas() {
        const resp = await fetch(API + "/admin/metas", { headers: auth() });
        const dados = await resp.json();

        const tbody = document.querySelector("#t
